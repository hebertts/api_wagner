<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Itens</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { background: #f5f5f5; }
        .container { max-width: 800px; margin-top: 40px; }
        .card { margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h2 class="text-center mb-4">Gerenciador de Itens</h2>

    <!-- LOGIN CARD -->
    <div class="card">
        <div class="card-header">Login</div>
        <div class="card-body">
            <input id="username" class="form-control mb-2" placeholder="Usuário: admin">
            <input id="password" type="password" class="form-control mb-2" placeholder="Senha: 123">
            <button class="btn btn-primary w-100" onclick="login()">Entrar</button>
        </div>
    </div>

    <!-- FORM ADD ITEM -->
    <div class="card">
        <div class="card-header">Adicionar Item</div>
        <div class="card-body">
            <input id="itemNome" class="form-control mb-2" placeholder="Nome">
            <input id="itemPreco" type="number" class="form-control mb-2" placeholder="Preço">
            <button class="btn btn-success w-100" onclick="addItem()">Adicionar</button>
        </div>
    </div>

    <!-- LISTA DE ITENS -->
    <div class="card">
        <div class="card-header">Itens cadastrados</div>
        <ul id="listaItens" class="list-group list-group-flush"></ul>
    </div>
</div>


<script>
    const API = "http://127.0.0.1:5000"; 
    let token = null;

    // ============ LOGIN ============
    function login() {
        const user = document.getElementById("username").value;
        const pass = document.getElementById("password").value;

        fetch(API + "/login", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ username: user, password: pass })
        })
        .then(res => res.json())
        .then(data => {
            if (!data.access_token) {
                alert("Credenciais inválidas");
                return;
            }

            token = data.access_token;
            alert("Login realizado!");
            loadItems();
        });
    }

    // ============ LISTAR ============
    function loadItems() {
        fetch(API + "/items", {
            headers: { "Authorization": "Bearer " + token }
        })
        .then(res => res.json())
        .then(items => {
            const list = document.getElementById("listaItens");
            list.innerHTML = "";

            items.forEach(item => {
                list.innerHTML += `
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <strong>${item.nome}</strong> <br>
                            <small>R$ ${item.preco.toFixed(2)}</small>
                        </div>

                        <div>
                            <button class="btn btn-warning btn-sm me-2" onclick="editItem(${item.id}, '${item.nome}', ${item.preco})">Editar</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem(${item.id})">Excluir</button>
                        </div>
                    </li>
                `;
            });
        });
    }

    // ============ ADICIONAR ============
    function addItem() {
        const nome = document.getElementById("itemNome").value;
        const preco = document.getElementById("itemPreco").value;

        fetch(API + "/items", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + token
            },
            body: JSON.stringify({ nome, preco })
        })
        .then(res => res.json())
        .then(() => {
            document.getElementById("itemNome").value = "";
            document.getElementById("itemPreco").value = "";
            loadItems();
        });
    }

    // ============ EDITAR ============
    function editItem(id, nomeAtual, precoAtual) {
        const novoNome = prompt("Novo nome:", nomeAtual);
        let novoPreco = prompt("Novo preço:", precoAtual);

        if (!novoNome || !novoPreco) return;

        novoPreco = parseFloat(novoPreco);

        fetch(API + "/items/" + id, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + token
            },
            body: JSON.stringify({ nome: novoNome, preco: novoPreco })
        })
        .then(() => loadItems());
    }

    // ============ DELETAR ============
    function deleteItem(id) {
        if (!confirm("Tem certeza que deseja excluir?")) return;

        fetch(API + "/items/" + id, {
            method: "DELETE",
            headers: { "Authorization": "Bearer " + token }
        })
        .then(() => loadItems());
    }
</script>

</body>
</html>
